<html>
	<head>
	<link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	<script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<title>
		engine_tests.cpp
	</title>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
#include &lt;boost/test/unit_test.hpp&gt;

#include "../engine/game_manager.hpp"
#include "../engine/room.hpp"
#include "../engine/controller.hpp"

std::string createAddRequest(int server_id)
<span style = "background-color:#dfd">{
	json req0 = {</span>
		{ "action", "add" },
		{ "data" , "test_nick" },
		{ "id", server_id }
	};
<span style = "background-color:#dfd">	return req0.dump();
}</span>

std::string createAddAnswer(std::vector&lt;int&gt; server_id, bool is_add_or_new_player, bool if_failed)
<span style = "background-color:#dfd">{
	json res0;
	if (if_failed) {
		res0["error"] = true;</span>
	}
<span style = "background-color:#dfd">	else {
		res0["error"] = false;</span>
	}
<span style = "background-color:#dfd">	if (is_add_or_new_player) {
		res0["action"] = "add";</span>
	}
<span style = "background-color:#dfd">	else {
		res0["action"] = "new_player";
		json tmp = {</span>
			{"id", server_id[0]},
			{"nick", "test_nick"}
		};
<span style = "background-color:#dfd">		res0["data"] = tmp;
		res0.erase("error");
		return res0.dump();</span>
	}
<span style = "background-color:#dfd">	for (auto i : server_id) {
		json player = {</span>
			{ "id", i },
			{ "nick", "test_nick" }
		};
<span style = "background-color:#dfd">		res0["data"].push_back(player);
	}
	return res0.dump();
}</span>

std::string createTextMessage(std::string&amp; msg, int player_id = -1)
<span style = "background-color:#dfd">{
	json chat_message = {</span>
		{"action", "chat"},
		{"data", msg }
	};
<span style = "background-color:#dfd">	if (player_id != -1) {
		chat_message["player"] = player_id;</span>
	}
<span style = "background-color:#dfd">	return chat_message.dump();
}</span>

std::string createReadyMessage(int player_id = -1)
<span style = "background-color:#dfd">{
	json ready = {</span>
		{"action", "ready"}
	};
<span style = "background-color:#dfd">	if (player_id != -1) {</span>
<span style = "background-color:#fdd">		ready["player"] = player_id;</span>
	}
<span style = "background-color:#dfd">	return ready.dump();
}</span>

void readyToAll(GameManager&amp; man, std::vector&lt;int&gt; id)
<span style = "background-color:#dfd">{
	json feedback;
	feedback["action"] = "ready";
	for (auto&amp; i : id) {
		man.doWork(i, feedback.dump());
	}
}</span>

void addPlayersByAddMessage(GameManager&amp; man, std::vector&lt;int&gt; id, int server_id)
<span style = "background-color:#dfd">{</span>
	int new_id;
<span style = "background-color:#dfd">	if (server_id == -1) {
		man.doWork(id[0], createAddRequest(server_id))[0].first;
		new_id = 0;</span>
	}
<span style = "background-color:#dfd">	else {</span>
<span style = "background-color:#fdd">		new_id = server_id;
		man.doWork(id[0], createAddRequest(new_id));</span>
	}
<span style = "background-color:#dfd">	man.doWork(id[1], createAddRequest(new_id));
	man.doWork(id[2], createAddRequest(new_id));
}</span>

std::string createBidMessage(int bid)
<span style = "background-color:#dfd">{
	json msg = {</span>
		{"action", "bid"},
		{"data", bid}
	};
<span style = "background-color:#dfd">	return msg.dump();
}</span>

std::string createBidAnswer(size_t prev_id, int value, int curr_id)
<span style = "background-color:#dfd">{
	json msg = {</span>
		{"action", "bid"},
		{"data", {{"value", value},{ "id", prev_id } }},
		{"player", curr_id}
	};
<span style = "background-color:#dfd">	return msg.dump();
}</span>

std::string createDealMessage(int p1, int c1, int p2, int c2)
<span style = "background-color:#fdd">{
	json msg = {</span>
		{"action", "deal"},
		{ "action", {{{"player", p1}, {"card", c1 } } , { { "player", p2 },{ "card", c2 } }} }
	};
<span style = "background-color:#fdd">	return msg.dump();
}</span>

std::string createDealAnswer(suits suit, figures figure)
<span style = "background-color:#fdd">{
	json msg = {</span>
		{"action", "deal"},
		{"data", {{"figure", figure}, {"suit", suit}} }
	};
<span style = "background-color:#fdd">	return msg.dump();
}</span>

Player createPlayerWithAppropriateCards(suits type)
<span style = "background-color:#dfd">{
	std::string str = "test";
	Player player(type, str);
	std::vector&lt;figures&gt; figures = { NINE, JACK, QUEEN, KING, TEN, ACE };
	for (const auto&amp; i : figures) {
		player.getPlayersDeck().addCard(Card(i, type));
	}
	return player;
}</span>

void addPlayers(PlayersCollection&amp; players)
<span style = "background-color:#dfd">{
	std::string test = "test";
	for (int i = 0; i &lt; MAX_PLAYERS; ++i) {
		players.addPlayer(i, test);
	}
}</span>

void addScoreToPlayers(PlayersCollection&amp; players, std::vector&lt;std::pair&lt;int, int&gt;&gt; vec)
<span style = "background-color:#dfd">{
	addPlayers(players);
	players.prepareGame(true);
	for (int i = 0; i &lt; MAX_PLAYERS; ++i) {
		players.getArray()[i].getScoreClass().setClaim(vec[i].first, false);
		players.getArray()[i].getScoreClass().addToTurnScore(vec[i].second);
	}
}</span>

std::vector&lt;int&gt; getScoreOfPlayers(PlayersCollection&amp; players)
<span style = "background-color:#dfd">{
	std::vector&lt;int&gt; vec;
	for (auto&amp; i : players.getArray()) {
		vec.push_back(i.getScoreClass().getScore());
	}
	return vec;
}</span>

void addCards(Player&amp; player, std::vector&lt;Card&gt; vec)
<span style = "background-color:#dfd">{
	for (const auto&amp; i : vec) {
		player.getPlayersDeck().addCard(i);
	}
}</span>

std::string createLeaveMessage()
<span style = "background-color:#dfd">{
	json feedback = {</span>
		{"action", "disconnect"}
	};
<span style = "background-color:#dfd">	return feedback.dump();
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_SUITE(CardTests)
BOOST_AUTO_TEST_CASE(CreateCardAndGetMemberValues)
{
	Card c1(NINE, CLUBS);
	BOOST_CHECK(c1.getFigure() == NINE);
	BOOST_CHECK(c1.getSuit() == CLUBS);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(CreateAnotherCardAndCheckIfIsEqual)
{
	Card c1(NINE, CLUBS);
	Card c2(c1);
	BOOST_CHECK(c1.getFigure() == c2.getFigure() &amp;&amp;</span>
		c1.getSuit() == c2.getSuit());
<span style = "background-color:#dfd">}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(CreateCardAndSetIfUsed)
{
	Card c1(NINE, CLUBS);
	BOOST_REQUIRE(c1.getIsUsed() == false);
	c1.setIsUsed(true);
	BOOST_CHECK(c1.getIsUsed() == true);
}
BOOST_AUTO_TEST_SUITE_END()</span>


<span style = "background-color:#dfd">BOOST_FIXTURE_TEST_SUITE(PlayerDeckTests, PlayersDeck)
BOOST_AUTO_TEST_CASE(AddCardCheckDeckLengthAndClearDeck)
{
	Card c1(NINE, CLUBS);
	addCard(c1);
	BOOST_REQUIRE(getDeck().size() == 1);
	clearDeck();
	BOOST_CHECK(getDeck().size() == 0);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(CheckIfThereIsPairAndPlayCard)
{
	Card c1(NINE, CLUBS), c2(QUEEN, DIAMONDS), c3(KING, DIAMONDS);
	addCard(c1);
	addCard(c2);
	addCard(c3);
	BOOST_REQUIRE(playCard(1).getFigure() == c2.getFigure());
	BOOST_CHECK(doesHavePair(DIAMONDS) == true);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(ThrowWhenTryingToPlayNonExistingCard)
{
	BOOST_CHECK_THROW(playCard(0), std::out_of_range);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(ThrowWhenTryingToPlaySameCardTwice)
{
	addCard(Card(NINE, CLUBS));
	playCard(0);
	BOOST_CHECK_THROW(playCard(0), std::logic_error);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(ReturnAllCardsThatCanBePlayed1)
{
	std::vector&lt;suits&gt; suit = { CLUBS, SPADES, DIAMONDS, HEARTS };
	std::vector&lt;figures&gt; figure = { NINE, TEN, QUEEN, KING, ACE };
	for (const auto&amp; i : suit) {
		for (const auto&amp; j : figure) {
			addCard(Card(j, i));
		}
	}
	std::vector&lt;Card&gt; vec = { {JACK, SPADES}, {JACK, DIAMONDS} };
	json tmp = { 6, 7, 8, 9 };
	json tmp1 = getAllValidCards(vec, HEARTS);
	BOOST_CHECK_EQUAL(tmp1, tmp);</span>

<span style = "background-color:#dfd">}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(ReturnAllCardsThatCanBePlayed2)
{
	std::vector&lt;suits&gt; suit = { CLUBS, SPADES, DIAMONDS, HEARTS };
	std::vector&lt;figures&gt; figure = { NINE, TEN, QUEEN, KING, ACE };
	for (const auto&amp; i : suit) {
		for (const auto&amp; j : figure) {
			addCard(Card(j, i));
		}
	}
	std::vector&lt;Card&gt; vec = { { JACK, SPADES } };
	json tmp = { 6, 7, 8, 9 };
	json tmp1 = getAllValidCards(vec, HEARTS);
	BOOST_CHECK_EQUAL(tmp1, tmp);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(ReturnAllCardsThatCanBePlayed3)
{
	std::vector&lt;suits&gt; suit = { CLUBS, SPADES, DIAMONDS, HEARTS };
	std::vector&lt;figures&gt; figure = { NINE, TEN, QUEEN, KING, ACE };
	for (const auto&amp; i : suit) {
		for (const auto&amp; j : figure) {
			addCard(Card(j, i));
		}
	}
	std::vector&lt;Card&gt; vec = { { JACK, SPADES }, { NINE, HEARTS } };
	json tmp = { 16, 17, 18, 19 };
	json tmp1 = getAllValidCards(vec, HEARTS);
	BOOST_CHECK_EQUAL(tmp1, tmp);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(ReturnAllCardsThatCanBePlayed4)
{
	std::vector&lt;suits&gt; suit = { CLUBS, DIAMONDS, HEARTS };
	std::vector&lt;figures&gt; figure = { NINE, TEN, QUEEN, KING, ACE };
	for (const auto&amp; i : suit) {
		for (const auto&amp; j : figure) {
			addCard(Card(j, i));
		}
	}
	std::vector&lt;Card&gt; vec = { { JACK, SPADES },{ NINE, SPADES } };
	json tmp = { 10, 11, 12, 13, 14 };
	json tmp1 = getAllValidCards(vec, HEARTS);
	BOOST_CHECK_EQUAL(tmp1, tmp);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(ReturnAllCardsThatCanBePlayed5)
{
	std::vector&lt;suits&gt; suit = { CLUBS, SPADES, DIAMONDS, HEARTS };
	std::vector&lt;figures&gt; figure = { NINE, TEN, QUEEN, ACE };
	for (const auto&amp; i : suit) {
		for (const auto&amp; j : figure) {
			addCard(Card(j, i));
		}
	}
	std::vector&lt;Card&gt; vec = { { JACK, SPADES },{ TEN, SPADES } };
	json tmp = { 7 };
	json tmp1 = getAllValidCards(vec, HEARTS);
	BOOST_CHECK_EQUAL(tmp1, tmp);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(ReturnAllCardsThatCanBePlayed6)
{
	std::vector&lt;suits&gt; suit = { CLUBS, SPADES, DIAMONDS, HEARTS };
	std::vector&lt;figures&gt; figure = { NINE, TEN, QUEEN, ACE };
	for (const auto&amp; i : suit) {
		for (const auto&amp; j : figure) {
			addCard(Card(j, i));
		}
	}
	std::vector&lt;Card&gt; vec = {};
	json tmp = { 0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15 };
	json tmp1 = getAllValidCards(vec, HEARTS);
	BOOST_CHECK_EQUAL(tmp1, tmp);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(ReturnAllCardsThatCanBePlayed7)
{
	std::vector&lt;suits&gt; suit = { CLUBS };
	std::vector&lt;figures&gt; figure = { NINE, JACK, QUEEN, KING, TEN, ACE };
	for (const auto&amp; i : suit) {
		for (const auto&amp; j : figure) {
			addCard(Card(j, i));
		}
	}
	std::vector&lt;Card&gt; vec = { {NINE, DIAMONDS}, {TEN, SPADES} };
	json tmp = { 0,1,2,3,4,5 };
	json tmp1 = getAllValidCards(vec, HEARTS);
	BOOST_CHECK_EQUAL(tmp1, tmp);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(ReturnAllCardsThatCanBePlayed8)
{
	std::vector&lt;suits&gt; suit = { CLUBS };
	std::vector&lt;figures&gt; figure = { NINE, JACK, QUEEN, KING, TEN, ACE };
	for (const auto&amp; i : suit) {
		for (const auto&amp; j : figure) {
			addCard(Card(j, i));
		}
	}
	std::vector&lt;Card&gt; vec = { { NINE, DIAMONDS } };
	json tmp = { 0,1,2,3,4,5 };
	json tmp1 = getAllValidCards(vec, HEARTS);
	BOOST_CHECK_EQUAL(tmp1, tmp);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(ReturnAllCardsThatCanBePlayed9)
{
	std::vector&lt;suits&gt; suit = { CLUBS };
	std::vector&lt;figures&gt; figure = { NINE, JACK, QUEEN, KING, TEN, ACE };
	for (const auto&amp; i : suit) {
		for (const auto&amp; j : figure) {
			addCard(Card(j, i));
		}
	}
	addCard(Card(NINE, DIAMONDS));
	getDeck().back().setIsUsed(true);
	std::vector&lt;Card&gt; vec = { { TEN, DIAMONDS } };
	json tmp = { 0,1,2,3,4,5 };
	json tmp1 = getAllValidCards(vec, HEARTS);
	BOOST_CHECK_EQUAL(tmp1, tmp);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(ReturnAllCardsThatCanBePlayed10)
{
	std::vector&lt;suits&gt; suit = { CLUBS, DIAMONDS };
	std::vector&lt;figures&gt; figure = { NINE, QUEEN, KING, TEN };
	for (const auto&amp; i : suit) {
		for (const auto&amp; j : figure) {
			addCard(Card(j, i));
		}
	}
	addCard(Card(NINE, DIAMONDS));
	getDeck().back().setIsUsed(true);
	std::vector&lt;Card&gt; vec = { { JACK, DIAMONDS }, { ACE, DIAMONDS } };
	json tmp = { 4,5,6,7 };
	json tmp1 = getAllValidCards(vec, DIAMONDS);
	BOOST_CHECK_EQUAL(tmp1, tmp);
}</span>



<span style = "background-color:#dfd">BOOST_AUTO_TEST_SUITE_END()</span>

<span style = "background-color:#dfd">BOOST_FIXTURE_TEST_SUITE(ScoreTests, Score)
BOOST_AUTO_TEST_CASE(GetAndSetOverallScore)
{
	BOOST_REQUIRE(getScore() == 0);
	addScore(200);
	BOOST_CHECK(getScore() == 200);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(GetAndSetTurnScore)
{
	BOOST_REQUIRE(getTurnScore() == 0);
	addToTurnScore(15);
	BOOST_REQUIRE(getTurnScore() == 15);
	reset(false);
	BOOST_CHECK(getTurnScore() == 0);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(GetAndSetClaim)
{
	BOOST_REQUIRE(getClaim() == 0);
	BOOST_CHECK_THROW(setClaim(-10, false), std::logic_error);
	BOOST_REQUIRE(setClaim(100, false) == true);
	BOOST_REQUIRE(getClaim() == 100);
	reset(false);
	BOOST_CHECK(getClaim() == 0);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(CheckIfRoundMethodWorksProperly1)
{
	int x = 3;
	BOOST_CHECK_EQUAL(round(x), 0);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(CheckIfRoundMethodWorksProperly2)
{
	int x = 5;
	BOOST_CHECK_EQUAL(round(x), 10);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(CheckIfRoundMethodWorksProperly3)
{
	int x = 10;
	BOOST_CHECK_EQUAL(round(x), 10);
}
BOOST_AUTO_TEST_SUITE_END()</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_SUITE(PlayerTests)
BOOST_AUTO_TEST_CASE(CreatePlayerAndCheckItsParameters)
{
	std::string str = "test";
	Player p1(12, str);
	BOOST_CHECK(p1.getPlayersNick() == "test");
	BOOST_CHECK(p1.getPlayerId() == 12);
}
BOOST_AUTO_TEST_SUITE_END()</span>

<span style = "background-color:#dfd">BOOST_FIXTURE_TEST_SUITE(DeckTests, Deck)
BOOST_AUTO_TEST_CASE(HandOutCards)
{
	std::string s = "test";
	Player p1(1, s);
	players players_array;
	for (int i = 0; i &lt; 3; ++i) {
		players_array.push_back(p1);
	}
	BOOST_REQUIRE(players_array[0].getPlayersDeck().getDeck().size() == 0);
	dealCards(players_array);
	BOOST_REQUIRE(players_array[0].getPlayersDeck().getDeck().size() == 7);
	addBonusCards(players_array[0]);
	BOOST_CHECK(players_array[0].getPlayersDeck().getDeck().size() == 10);
}
BOOST_AUTO_TEST_SUITE_END()</span>

<span style = "background-color:#dfd">BOOST_FIXTURE_TEST_SUITE(PlayersCollectionTest, PlayersCollection)
BOOST_AUTO_TEST_CASE(AddNewPlayer)
{
	std::string s = "test";
	BOOST_REQUIRE(getArray().size() == 0);
	addPlayer(12, s);
	BOOST_CHECK(getArray().size() == 1);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(GetNotExistingPlayer)
{
	BOOST_CHECK_THROW(getPlayer(X, 0), std::out_of_range);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(SetNonExistingPlayer)
{
	BOOST_CHECK_THROW(setPlayer(CURRENT,0), std::out_of_range);
}
BOOST_AUTO_TEST_SUITE_END()</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_SUITE(DealerTest)
BOOST_AUTO_TEST_CASE(DealerGiveCardToPeer)
{
	Deck deck;
	PlayersCollection players;
	Dealer d(deck, players);
	addPlayers(players);
	players.prepareGame(true);
	players.setPlayer(HIGHEST, players.getArray()[0].getPlayerId());
	BOOST_CHECK_THROW(d.giveCardToPeer(2, 0), std::out_of_range);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(Return120MaxValue)
{
	std::string test = "test";
	Player p(0, test);
	addCards(p, { { QUEEN, HEARTS }, { QUEEN, DIAMONDS}, {KING, SPADES}, { QUEEN, CLUBS } });
	BOOST_CHECK_EQUAL(p.getPlayersDeck().getMaxValue(false), 120);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(Return160MaxValue)
{
	std::string test = "test";
	Player p(0, test);
	addCards(p, { { QUEEN, HEARTS },{ QUEEN, DIAMONDS },{ KING, SPADES },{ QUEEN, SPADES } });
	BOOST_CHECK_EQUAL(p.getPlayersDeck().getMaxValue(false), 160);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(Return180MaxValue)
{
	std::string test = "test";
	Player p(0, test);
	addCards(p, { { QUEEN, HEARTS },{ QUEEN, DIAMONDS },{ KING, SPADES },{ ACE, SPADES },</span>
	{ KING, CLUBS },{ QUEEN, CLUBS} });
<span style = "background-color:#dfd">	BOOST_CHECK_EQUAL(p.getPlayersDeck().getMaxValue(false), 180);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(Return200MaxValue)
{
	std::string test = "test";
	Player p(0, test);
	addCards(p, { { QUEEN, HEARTS },{ QUEEN, DIAMONDS },{ KING, SPADES },{ ACE, SPADES },</span>
	{ KING, CLUBS },{ KING, DIAMONDS } });
<span style = "background-color:#dfd">	BOOST_CHECK_EQUAL(p.getPlayersDeck().getMaxValue(false), 200);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(Return220MaxValue)
{
	std::string test = "test";
	Player p(0, test);
	addCards(p, { { QUEEN, HEARTS },{ QUEEN, DIAMONDS },{ KING, SPADES },{ ACE, SPADES },</span>
	{ KING, HEARTS },{ QUEEN, CLUBS } });
<span style = "background-color:#dfd">	BOOST_CHECK_EQUAL(p.getPlayersDeck().getMaxValue(false), 220);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(Return300MaxValue)
{
	std::string test = "test";
	Player p(0, test);
	addCards(p, { { QUEEN, HEARTS },{ QUEEN, DIAMONDS },{ KING, DIAMONDS },{ ACE, SPADES },</span>
	{ KING, HEARTS },{ QUEEN, CLUBS } });
<span style = "background-color:#dfd">	BOOST_CHECK_EQUAL(p.getPlayersDeck().getMaxValue(false), 300);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_SUITE_END()</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_SUITE(BidderTest)
BOOST_AUTO_TEST_CASE(IfBidsBecomesHighestBidder)
{
	Deck deck;
	PlayersCollection players;
	Bidder bid(deck, players);
	addPlayers(players);
	players.prepareGame(true);
	json msg = { {"player", 1 }, {"data", 120} };
	bid.bid(msg, BIDDING);
	BOOST_CHECK_EQUAL(1, players.getPlayer(HIGHEST).getPlayerId());
	BOOST_CHECK_EQUAL(players.getPlayer(HIGHEST).getScoreClass().getClaim(),120);
}
BOOST_AUTO_TEST_CASE(ThrowIfBidsNotAtHisTurn)
{
	Deck deck;
	PlayersCollection players;
	Bidder bid(deck, players);
	addPlayers(players);
	players.prepareGame(true);
	players.getNextPlayer(CURRENT);
	json msg = { { "player", 0 },{ "data", 110 } };
	BOOST_CHECK_THROW(bid.bid(msg, BIDDING), std::logic_error);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(ThrowIfBidsLessThanActual)
{
	Deck deck;
	PlayersCollection players;
	Bidder bid(deck, players);
	addPlayers(players);
	players.prepareGame(true);
	players.getNextPlayer(CURRENT); 
	json msg = { { "player", 3 },{ "data", 90 } };
	BOOST_CHECK_THROW(bid.bid(msg, BIDDING), std::logic_error);
}
BOOST_AUTO_TEST_SUITE_END()</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_SUITE(AdderRoomTests)
BOOST_AUTO_TEST_CASE(RoomAddNewPlayer)
{
	GameManager man;
	BOOST_CHECK_EQUAL(man.doWork(0, createAddRequest(-1))[0].first, createAddAnswer({ 0 }, true, false));
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(RoomAddAtLeastFourPlayersSoMultipleRoomsAreCreated)
{
	GameManager man;
	BOOST_CHECK_EQUAL(man.doWork(0, createAddRequest(-1))[0].first, createAddAnswer({ 0 }, true, false));
	BOOST_CHECK_EQUAL(man.doWork(1, createAddRequest(0))[1].first, createAddAnswer({ 0, 1 }, true, false));
	BOOST_CHECK_EQUAL(man.doWork(2, createAddRequest(0))[1].first, createAddAnswer({ 0, 1, 2 }, true, false));
	BOOST_CHECK_EQUAL(man.doWork(3, createAddRequest(-1))[0].first, createAddAnswer({ 3 }, true, false));
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(AddToRoomMoreThan3)
{
	GameManager man;
	BOOST_CHECK_EQUAL(man.doWork(0, createAddRequest(-1))[0].first, createAddAnswer({ 0 }, true, false));
	BOOST_CHECK_EQUAL(man.doWork(1, createAddRequest(0))[1].first, createAddAnswer({ 0, 1 }, true, false));
	BOOST_CHECK_EQUAL(man.doWork(2, createAddRequest(0))[1].first, createAddAnswer({ 0, 1, 2 }, true, false));
	BOOST_CHECK_EQUAL(man.doWork(3, createAddRequest(0))[0].first, createAddAnswer({ }, true, true));
}</span>


<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(AddTwoAndGetAllMessageBack)
{
	GameManager man;
	man.doWork(0, createAddRequest(-1));
	req feedback2 = man.doWork(1, createAddRequest(0));
	BOOST_CHECK_EQUAL(feedback2[1].first, createAddAnswer({ 0, 1 }, true, false));
	BOOST_CHECK_EQUAL(feedback2[0].first, createAddAnswer({ 1 }, false, false));
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_SUITE_END()</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_SUITE(GameManagerTests)
BOOST_AUTO_TEST_CASE(SendAndReceiveMessage)
{
	GameManager man;
	std::string test = "test message";
	for (int i = 0; i &lt; 3; ++i) {
		man.doWork(i, createAddRequest(i &gt; 0 ? 0 : -1));
	}
	req feedback = man.doWork(1, createTextMessage(test));
	BOOST_CHECK_EQUAL(feedback.size(), 1);
	BOOST_CHECK_EQUAL(feedback[0].first, createTextMessage(test, 1));
	BOOST_CHECK_EQUAL(feedback[0].second[0], 0);
	BOOST_CHECK_EQUAL(feedback[0].second[1], 2);
}</span>

//BOOST_AUTO_TEST_CASE(PlayersGetReadyAndGetMessageBack)
//{
//	GameManager man;
//	for (int i = 0; i &lt; 3; ++i) {
//		man.doWork(i, createAddRequest(i &gt; 0 ? 0 : -1));
//	}
//	req feedback = man.doWork(0, createReadyMessage());
//	BOOST_CHECK_EQUAL(feedback[0].first, createReadyMessage(0));
//	BOOST_CHECK_EQUAL(feedback[0].second[0], 1);
//	BOOST_CHECK_EQUAL(feedback[0].second[1], 2);
//}

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(PlayersGetReadyAndBid)
{
	GameManager man;
	for (int i = 0; i &lt; 3; ++i) {
		man.doWork(i, createAddRequest(i &gt; 0 ? 0 : -1));
	}</span>

<span style = "background-color:#dfd">	for (int i = 0; i &lt; 3; ++i) {
		man.doWork(i, createReadyMessage());
	}
	req feedback = man.doWork(1, createBidMessage(110));
	BOOST_CHECK_EQUAL(feedback[0].first, createBidAnswer(1, 110, 2));
	json info = json::parse(feedback[1].first.begin(), feedback[1].first.end());
	BOOST_CHECK(info["data"]["min"] == 120);
	BOOST_CHECK(info["data"]["max"] != 0);
	BOOST_CHECK_EQUAL(feedback[1].second.size(), 1);
	BOOST_CHECK_EQUAL(feedback[1].second[0], 2);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(PlayersGetReadyAndBidNegative)
{
	GameManager man;
	for (int i = 0; i &lt; 3; ++i) {
		man.doWork(i, createAddRequest(i &gt; 0 ? 0 : -1));
	}
	for (int i = 0; i &lt; 3; ++i) {
		man.doWork(i, createReadyMessage());
	}
	req feedback = man.doWork(1, createBidMessage(-1));
	BOOST_CHECK_EQUAL(feedback[0].first, createBidAnswer(1, -1, 2));
	feedback = man.doWork(2, createBidMessage(-1));
	BOOST_CHECK_EQUAL(feedback[0].first, createBidAnswer(2, -1, -1));
	json msg = json::parse(feedback[1].first.begin(), feedback[1].first.end());
	BOOST_CHECK_EQUAL(msg["action"], "stock");
	BOOST_CHECK_EQUAL(msg["data"].size(), 3);
	BOOST_CHECK_EQUAL(feedback[0].second.size(), 3);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(PlayThreeCardsAndGetCorrectMessageBack1)
{
	std::vector&lt;PController&gt; vec;
	PlayersCollection players;
	Deck deck;
	Game game(deck, players, vec);
	players.getArray().push_back(createPlayerWithAppropriateCards(SPADES));
	players.getArray().push_back(createPlayerWithAppropriateCards(DIAMONDS));
	players.getArray().push_back(createPlayerWithAppropriateCards(HEARTS));
	players.prepareGame(true);
	players.getNextPlayer(CURRENT);
	players.getNextPlayer(CURRENT);
	game.manageTurn(SPADES, 0);
	game.manageTurn(DIAMONDS, 0);
	game.manageTurn(HEARTS, 0);
	int player = game.compareCardsAndPassToWinner();
	BOOST_CHECK_EQUAL(player, SPADES);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(PlayThreeCardsAndGetCorrectMessageBack2)
{
	std::vector&lt;PController&gt; vec;
	PlayersCollection players;
	Deck deck;
	Game game(deck, players, vec);
	json msg;
	players.getArray().push_back(createPlayerWithAppropriateCards(SPADES));
	players.getArray().push_back(createPlayerWithAppropriateCards(DIAMONDS));
	players.getArray().push_back(createPlayerWithAppropriateCards(HEARTS));
	players.getArray()[1].getPlayersDeck().addCard(Card(ACE, SPADES));
	players.prepareGame(true);
	players.getNextPlayer(CURRENT);
	players.getNextPlayer(CURRENT);
	game.manageTurn(SPADES, 2);
	game.manageTurn(DIAMONDS, 0);
	game.manageTurn(HEARTS, 0);
	request_type request = game.createMessages(msg,PLAYING);
	json available_cards = request[0]["data"]["available"];
	json expected_cards = { 0,1,3,4,5 };
	BOOST_CHECK_EQUAL(available_cards, expected_cards);
	game.manageTurn(SPADES, 3);
	game.manageTurn(DIAMONDS, 6);
	game.manageTurn(HEARTS, 2);
	int player = game.compareCardsAndPassToWinner();
	BOOST_CHECK_EQUAL(player, DIAMONDS);
}
BOOST_AUTO_TEST_SUITE_END()</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_SUITE(SumTestClassTests)
BOOST_AUTO_TEST_CASE(AddScoreToAllPlayers1)
{
	std::vector&lt;PController&gt; vec;
	PlayersCollection players;
	Deck deck;
	SumScore score(deck, players, vec);
	addScoreToPlayers(players, { { 140, 120 },{ -1, 36 },{ -1, 14 } });
	score.sumUpScore();
	json expected = { -140, 40, 10 }, returned = getScoreOfPlayers(players);
	BOOST_CHECK_EQUAL(expected, returned);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(AddScoreToAllPlayers2)
{
	std::vector&lt;PController&gt; vec;
	PlayersCollection players;
	Deck deck;
	SumScore score(deck, players, vec);
	addScoreToPlayers(players, { { 140, 144 },{ -1, 36 },{ -1, 14 } });
	score.sumUpScore();
	json expected = { 140, 40, 10 }, returned = getScoreOfPlayers(players);
	BOOST_CHECK_EQUAL(expected, returned);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_SUITE_END()</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_SUITE(LeaveBusterTests)
BOOST_AUTO_TEST_CASE(AddThreeStartGameThenLeaveAndStartGameAgain)
{
	GameManager man;
	addPlayersByAddMessage(man, { 0,1,2 }, -1);
	readyToAll(man, { 0,1,2 });
	man.doWork(0, createLeaveMessage());
	man.doWork(0, createAddRequest(0));
	readyToAll(man, { 0,1,2 });
}
BOOST_AUTO_TEST_SUITE_END()</span></pre>
	</body>
</html>